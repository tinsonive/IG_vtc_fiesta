<html>
<head>
    <title>VTC Skill Fiesta - IT Sarah</title>
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="row" id="row1">
        </div>
        <div class="row" id="row2">
        </div>
    </div>
    <script src="js/handler.js">
        var newList = null;
        var currentList = null;
        var isFirstLoad = false;

        const delay = ms => new Promise(res => setTimeout(res, ms));

        function firstLoad () 
        {
            medialist = medialist.filter(item => (item.media_type != "CAROUSEL_ALBUM"));

            medialist.sort(function(a, b){
                if (a.timestamp < b.timestamp) {return -1;}
                if (a.timestamp > b.timestamp) {return 1;}
                return 0;
            });

            newList = medialist;
            
            for (var i = 0; i < newList.length >= 8 ? 8 : newList.length; i++)
            {
                AddItem(i, newList[i].media_url, newList[i].media_type);
            }

            currentList = newList;
        };

        function AddItem (index, link, type)
        {
            const row_id = (index != 0 && index % 4) ? "row1" : "row2";

            const newItem = document.createElement('div');
            newItem.classList.add('col-2');

            var newhtml = "";

            if (type == "IMAGE")
            {
                newhtml = '<img class="img-responsive" src="'+link+'">';
            }
            else if (type == "VIDEO")
            {
                newhtml = '<video loop width="100%" height="100%">'+
                            '<source src="'+link+'" type="video/mp4">'+
                            '</video>';
            }

            document.getElementById(row_id).appendChild(newItem).innerHTML = newhtml;
        }

        function RemoveLastItem (lastRange)
        {
            if (lastRange >= 4)
            {
                document.getElementById("row2").innerHTML = '';
                
                if (lastRange - 4 > 0)
                {
                    const row1 = document.getElementById("row1");
                    for (var i = 0; i < lastRange - 4; i++)
                        row1.removeChild(menu.lastElementChild);
                }
            }
            else
            {
                const row2 = document.getElementById("row2");
                for (var i = 0; i < lastRange - 4; i++)
                    row2.removeChild(menu.lastElementChild);
            }
        }

        const yourFunction = async () => {
            do
            {
                if (medialist != null && !isFirstLoad)
                {
                    firstLoad();
                    isFirstLoad = true;
                    await delay(5000);
                    continue;
                }

                if (medialist != null)
                {
                    const comingList = medialist.filter((item) => !newList.includes(item));

                    for (var i = 0; i < comingList.length >= 8 ? 8 : comingList.length; i++)
                    {
                        AddItem(i, comingList[i].media_url, comingList[i].media_type);
                    }
                    
                    RemoveLastItem(newList.length);
                }

                await delay(5000);
            } while (true)
        };

        yourFunction();
    </script>
</body>
</html>